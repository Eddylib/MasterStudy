# 基于卡尔曼滤波的鼠标跟踪程序

`介绍及使用方法`
------------
* 卡尔曼滤波跟踪鼠标位置的演示程序
* 蓝色为真实值
* 红色为后验估计值
* 绿色为观测值

运行：mouseTracker.m即可。

`内容`
------------
* falseEKF目录已经完成,这是以一个非线性卡尔曼滤波来对待鼠标跟踪问题问题。但这是在还未深入理解卡尔曼滤波的情况下改编的别人的代码。效果并不是很好。接下来会继续改进。
* mouseTracker目录完成，这是以一个线性卡尔曼滤波来对待鼠标跟踪问题问题。但匀速运动模型本身就是不正确的。导致并没有好的结果。


`首更`
------------
卡尔曼滤波个人理解:
对于一个大致知道其运动模型,且有一些不准确的观察点的情况下。需要一种方法将这两个信息结合起来组成更可靠的信息。通常方法自然就是加权求和。但是加权求和的权重需要考虑,不能人为给出。而卡尔曼滤波的核心要义就是求出这一个权重,这一权重也叫作增益因子。
其获得的思路是:

使得估计值(先验)和真实值(不存在,无法给出,仅仅是个符号,在求导后被消去)间误差的均方差最小化。
具体推导见：

```
http://blog.csdn.net/heyijia0327/article/details/17487467
```

这就造成了卡尔曼滤波只能应对线性系统。而这里说的线性系统指的是运动模型的递推公式满足线性(运动模型本身可以是随时间的二次函数)。在求导时需要删去状态自变量,于是观测模型也需要是线性的(即)。

针对这一限制,才有了扩展卡尔曼滤波。其实也简单,就是直接取运动模型和观测模型泰勒展开。然后省略高阶导数项，把系统直接就线性化了。之后就是普通的卡尔曼滤波。而这会造成误差较大。写的程序是根据

```
http://blog.csdn.net/lizilpl/article/details/45289541
```

提供的代码改编而成。
暂时感觉对卡尔曼滤波还是有一些困惑，代码效果也不是很好，结果和标准差参数相关性很大。还是不明白为何是这个样子。。。继续学习


`2017.3.9`
------------
从state estimation for robotics 上重温了卡尔曼滤波。完全理解了卡尔曼滤波的一个推导来源（也就是说卡尔曼滤波可以从不同的方向去解释它的由来）。
最近几天由于有SEFR这本书，加上老师指导，回顾上个版本写的代码即“refine to a standard project structure”这次提交，以下简称RTA。发现RTA版本代码确实有问题。
* RTA对运动模型和观测模型的处理不太恰当：
运动模型直接在真实值上加了一个高斯噪声。观测模型模型也是在真实值上加了一个高斯噪声。这样就造成了实际是对真实值的两个高斯噪声观测的滤波。而经过老师指导发现，运动模型不是一个对真实值的观测，而是来自于对自身的判断，如根据自身位置，速度，加速度来判断自己的状态。典型的模型有匀速运动模型，IMU给予信息的状态更新。而观测模型则是对外界信息的观测，典型的就是通过激光、摄像机、GPS等传感器对自身的观测。
当然，我个人觉得，卡尔曼滤波本身就是一个融合多个传感器的信息。这里是否不需要划分如此清晰？由此引出一个疑
* 问，多传感器信息又如何融合？-----这个问题我会继续思考，有了结果会在这里跟新。
* RTA版本将鼠标跟踪问题看成了一个非线性系统：
有了近几日的学习，我发现这是个错误的看法。首先观测模型在模拟程序中就是直接对点的探测，本身就是线性的。而如果运动模型也是线性的话，那所有部分就都是线性的了。所以没必要用所谓的扩展卡尔曼滤波。

* 引出问题，到底什么是线性系统，什么是非线性系统？是指观测模型和运动模型都为线性才为线性系统？


`2017.3.9.2`
------------
完成代码.又出现问题:系统转移矩阵一般采用齐次坐标,引入了一个新的维度,然而新的维度引入,方差该怎么处理?
如果对应那一维度的方差为0,会造成求卡尔曼增益时,协方差会是奇异矩阵.
目前处理方法就是采用齐次坐标,在求卡尔曼增益时把多余的一位割掉求增益...不知这种处理方法是否正确...


结果是:估计值的总误差比观测值的总误差还要大!!!!!!!!
这是个令人发狂的结果...做了半天还不如直接去观测呢!

反思如下:
-------------->对齐次坐标的协方差处理不太正确导致的误差....(换1试试...，效果好一些但又觉得不合理，得从公式的推到上来分析一下)
调参影响还是很大....过程:测量的标准差比为15:30时效果较好
要想使估计结果更好,必须有正确的运动模型和合理的方差设置。



`2017.3.14`
------------
根据
```
http://www.cnblogs.com/rubbninja/p/6220284.html
```
受到启发，所谓匀速运动模型就是匀速，其状态转换矩阵A是一定的，不需要状态的上一次值。这才是线性系统！我之前想象中的匀速运动是临时匀速，即下一时刻的位置为这一时刻加上从上一时刻到这一时刻的位移。而这要求A和上一时刻的位置有关。这已经不是线性系统。

文章中的代码我也实现了，发现系统速度如果一定的话，只有保持那个初始速度才能较好的滤波。此次提交就是这个版本。鉴于此文件夹是卡尔曼滤波，就将这次提交保存为这个样子。

程序表现：
* 由于对速度有一个随机的初始化，会导致会有一个随机的初始速度。之后只有按照这个速度的运动才会有好的后验结果。
* 由于实际的鼠标追踪非匀速运动，所以卡尔曼滤波对此问题没有帮助。

得出以下结论：
* 真正的线性模型，其A和状态无关。
* 匀速运动模型并不实用。
* 实用的模型才能通过滤波对观测值有所优化。
* 应该快速开展非线性系统的学习研究。

